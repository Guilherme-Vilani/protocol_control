<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FMO - Protocolo</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700&display=swap"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.8/jquery.inputmask.min.js"></script>
  </head>
  <body>
    <header class="header">
      <img src="images/logo_site.png" alt="Logo FMO" class="logo" />
      <h1>Faculdade de Medicina de Olinda - Protocolo</h1>
    </header>

    <div class="container">
      <h2>Bem-vindo ao Protocolo</h2>
      <p>
        Protocolo FMO é um canal ativo e democrático de comunicação entre a
        comunidade acadêmica e as instâncias administrativas da Faculdade.
      </p>

      <h3>Formulário de Contato</h3>
      <div id="loading" class="loading" style="display: none">
        <div class="spinner"></div>
        <p>Enviando...</p>
      </div>

      <form id="ouvidoria-form">
        <div class="form-group">
          <label for="nome">Nome:</label>
          <input type="text" id="nome" name="nome" required />
        </div>
        <div class="form-row">
          <div class="form-group" style="flex: 1">
            <label for="cpf">CPF:</label>
            <input type="text" id="cpf" name="cpf" required />
          </div>
          <div class="form-group" style="flex: 1">
            <label for="telefone">Telefone:</label>
            <input type="text" id="telefone" name="telefone" required />
          </div>
        </div>
        <div class="form-group">
          <label for="email">E-mail:</label>
          <input type="email" id="email" name="email" required />
        </div>
        <div class="form-group">
          <label for="matricula">Número da Matrícula:</label>
          <input type="text" id="matricula" name="matricula" required />
        </div>
        <div class="form-group">
          <label for="assunto">Assunto:</label>
          <select id="assunto" name="assunto" required>
            <option value="01">Alteração de endereço</option>
            <option value="02">Alteração de nome</option>
            <option value="03">Cancelamento de matrícula</option>
            <option value="04">Carteira da Biblioteca (2° via)</option>
            <option value="05">Declaração de autorização do curso</option>
            <option value="06">Declaração de horários de aula</option>
            <option value="07">Declaração de matrícula</option>
            <option value="08">Declaração de estágio obrigatório</option>
            <option value="09">Declaração dos dias de prova</option>
            <option value="10">Segunda Chamada de Prova</option>
            <option value="11">Declaração de reconhecimento de curso</option>
            <option value="12">Diploma</option>
            <option value="13">Dispensa de Disciplina</option>
            <option value="14">Grade curricular do curso</option>
            <option value="15">Histórico escolar para aluno</option>
            <option value="16">Histórico escolar para ex-aluno</option>
            <option value="17">Declaração de quitação com a tesouraria</option>
            <option value="18">Revisão de prova</option>
            <option value="19">Trancamento de Matrícula</option>
            <option value="20">Outros</option>
          </select>
        </div>
        <div class="form-group">
          <label for="periodo">Período:</label>
          <select id="periodo" name="periodo" required>
            <option value="P01">P01</option>
            <option value="P02">P02</option>
            <option value="P03">P03</option>
            <option value="P04">P04</option>
            <option value="P05">P05</option>
            <option value="P06">P06</option>
            <option value="P07">P07</option>
            <option value="P08">P08</option>
            <option value="P09">P09</option>
            <option value="P10">P10</option>
            <option value="P11">P11</option>
            <option value="P12">P12</option>
          </select>
        </div>
        <div class="form-group">
          <label for="disciplina">Disciplina:</label>
          <select id="disciplina" name="disciplina" required>
            <option value="UC01">UC01</option>
            <option value="UC02">UC02</option>
            <option value="UC03">UC03</option>
            <option value="UC04">UC04</option>
            <option value="UC05">UC05</option>
            <option value="UC06">UC06</option>
            <option value="UC07">UC07</option>
            <option value="UC08">UC08</option>
            <option value="UC09">UC09</option>
            <option value="UC10">UC10</option>
            <option value="UC11">UC11</option>
            <option value="UC12">UC12</option>
            <option value="UC13">UC13</option>
            <option value="UC14">UC14</option>
            <option value="UC15">UC15</option>
            <option value="UC16">UC16</option>
            <option value="UC17">UC17</option>
            <option value="UC18">UC18</option>
            <option value="UC19">UC19</option>
            <option value="UC20">UC20</option>
            <option value="UC21">UC21</option>
            <option value="UC22">UC22</option>
            <option value="UC23">UC23</option>
            <option value="UC24">UC24</option>
            <option value="UC25">UC25</option>
            <option value="UC26">UC26</option>
            <option value="UC27">UC27</option>
            <option value="UC28">UC28</option>
            <option value="UC29">UC29</option>
            <option value="UC30">UC30</option>
            <option value="UC31">UC31</option>
            <option value="UC32">UC32</option>
            <option value="UC33">UC33</option>
            <option value="UC34">UC34</option>
            <option value="UC35">UC35</option>
            <option value="UC36">UC36</option>
            <option value="UC37">UC37</option>
            <option value="UC38">UC38</option>
            <option value="UC39">UC39</option>
            <option value="UC40">UC40</option>
            <option value="UC41">UC41</option>
            <option value="UC42">UC42</option>
            <option value="UC43">UC43</option>
            <option value="UC44">UC44</option>
            <option value="UC45">UC45</option>
          </select>
        </div>
        <div class="form-group">
          <label for="mensagem">Mensagem:</label>
          <textarea
            id="mensagem"
            name="mensagem"
            rows="5"
            maxlength="600"
            required
          ></textarea>
        </div>
        <div class="form-group">
          <label for="anexos">Anexar arquivos:</label>
          <input type="file" id="anexos" name="anexos" multiple />
        </div>
        <button type="submit">Enviar</button>
      </form>
      <div id="success-message" class="success-message"></div>
    </div>

    <footer class="footer">
      <p>
        &copy; 2025 Faculdade de Medicina de Olinda. Todos os direitos
        reservados.
      </p>
    </footer>

    <script>
      // Aplica as máscaras ao carregar a página
      $(document).ready(function () {
        $("#cpf").inputmask("999.999.999-99");
        $("#telefone").inputmask("(99) 99999-9999");
      });

      document
        .getElementById("ouvidoria-form")
        .addEventListener("submit", async function (event) {
          event.preventDefault();

          let formData = new FormData();

          const data = JSON.stringify({
            nome: document.getElementById("nome").value,
            cpf: document.getElementById("cpf").value,
            telefone: document.getElementById("telefone").value,
            email: document.getElementById("email").value,
            matricula: document.getElementById("matricula").value,
            assunto: document.getElementById("assunto").value,
            mensagem: document.getElementById("mensagem").value,
          });

          formData.append("protocol_data", data);

          let filesInput = document.getElementById("anexos");
          for (let i = 0; i < filesInput.files.length; i++) {
            formData.append("files", filesInput.files[i]);
          }

          // Exibir loading e desativar botão
          document.getElementById("loading").style.display = "flex";
          let submitButton = document.querySelector("button[type='submit']");
          submitButton.disabled = true;

          try {
            let response = await fetch(
              "http://localhost:8000/insert-protocol/",
              {
                method: "POST",
                body: formData,
              }
            );

            let result = await response.json();

            if (response.ok) {
              document.getElementById("success-message").innerText =
                "Protocolo enviado com sucesso!";
              document.getElementById("success-message").style.color = "green";
              document.getElementById("ouvidoria-form").reset();
            } else {
              throw new Error(result.detail || "Erro ao enviar protocolo");
            }
          } catch (error) {
            document.getElementById("success-message").innerText =
              "Erro: " + error.message;
            document.getElementById("success-message").style.color = "red";
          } finally {
            // Ocultar loading e reativar botão
            document.getElementById("loading").style.display = "none";
            submitButton.disabled = false;
          }
        });
    </script>

    <style>
      body {
        font-family: "Roboto", sans-serif;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
      }

      .header {
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #005eb8;
        color: white;
        padding: 20px;
        text-align: center;
      }

      .logo {
        max-height: 80px;
        max-width: 150px;
        margin-right: 20px;
      }

      .container {
        max-width: 600px;
        width: 80%;
        margin: 20px auto;
        padding: 20px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        flex: 1;
      }

      .form-group {
        margin-bottom: 15px;
      }

      label {
        font-weight: bold;
        display: block;
        margin-bottom: 5px;
      }

      input,
      textarea,
      select {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
        resize: vertical;
      }

      button {
        width: 100%;
        padding: 10px;
        background-color: #005eb8;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
      }

      button:hover {
        background-color: #002244;
      }

      .footer {
        background-color: #005eb8;
        color: white;
        text-align: center;
        padding: 10px;
        margin-top: auto;
      }

      .success-message {
        display: none;
        background-color: #d4edda;
        color: #155724;
        padding: 10px;
        border-radius: 4px;
        margin-top: 10px;
      }

      .loading {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.8);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        font-size: 18px;
        font-weight: bold;
        color: #333;
      }

      .spinner {
        border: 5px solid rgba(0, 0, 0, 0.1);
        border-top: 5px solid #005eb8;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin-bottom: 10px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Tabela */
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      th,
      td {
        border: 1px solid #ccc;
        padding: 10px;
        text-align: left;
      }

      th {
        background-color: #005eb8;
        color: white;
        font-weight: bold;
      }

      tbody tr:nth-child(even) {
        background-color: #f2f2f2;
      }

      tbody tr:hover {
        background-color: #ddd;
      }

      /* Responsividade */
      @media (max-width: 768px) {
        .container {
          width: 90%;
        }
        .header {
          flex-direction: column;
          align-items: center;
        }
        .logo {
          margin-bottom: 10px;
        }
        h1 {
          font-size: 18px;
        }
        button {
          font-size: 14px;
        }
        table {
          font-size: 14px;
        }
        th,
        td {
          padding: 8px;
        }
      }
    </style>
  </body>
</html>
